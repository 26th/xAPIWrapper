/*! xAPIWrapper v 1.10.1 | Built on 2017-04-10 14:55:13-0400 */
var CryptoJS=CryptoJS||function(a,b){var c={},d=c.lib={},e=d.Base=function(){function a(){}return{extend:function(b){a.prototype=this;var c=new a;return b&&c.mixIn(b),c.hasOwnProperty("init")||(c.init=function(){c.$super.init.apply(this,arguments)}),c.init.prototype=c,c.$super=this,c},create:function(){var a=this.extend();return a.init.apply(a,arguments),a},init:function(){},mixIn:function(a){for(var b in a)a.hasOwnProperty(b)&&(this[b]=a[b]);a.hasOwnProperty("toString")&&(this.toString=a.toString)},clone:function(){return this.init.prototype.extend(this)}}}(),f=d.WordArray=e.extend({init:function(a,c){a=this.words=a||[],c!=b?this.sigBytes=c:this.sigBytes=4*a.length},toString:function(a){return(a||h).stringify(this)},concat:function(a){var b=this.words,c=a.words,d=this.sigBytes,e=a.sigBytes;if(this.clamp(),d%4)for(var f=0;e>f;f++){var g=c[f>>>2]>>>24-f%4*8&255;b[d+f>>>2]|=g<<24-(d+f)%4*8}else if(c.length>65535)for(var f=0;e>f;f+=4)b[d+f>>>2]=c[f>>>2];else b.push.apply(b,c);return this.sigBytes+=e,this},clamp:function(){var b=this.words,c=this.sigBytes;b[c>>>2]&=4294967295<<32-c%4*8,b.length=a.ceil(c/4)},clone:function(){var a=e.clone.call(this);return a.words=this.words.slice(0),a},random:function(b){for(var c=[],d=0;b>d;d+=4)c.push(4294967296*a.random()|0);return new f.init(c,b)}}),g=c.enc={},h=g.Hex={stringify:function(a){for(var b=a.words,c=a.sigBytes,d=[],e=0;c>e;e++){var f=b[e>>>2]>>>24-e%4*8&255;d.push((f>>>4).toString(16)),d.push((15&f).toString(16))}return d.join("")},parse:function(a){for(var b=a.length,c=[],d=0;b>d;d+=2)c[d>>>3]|=parseInt(a.substr(d,2),16)<<24-d%8*4;return new f.init(c,b/2)}},i=g.Latin1={stringify:function(a){for(var b=a.words,c=a.sigBytes,d=[],e=0;c>e;e++){var f=b[e>>>2]>>>24-e%4*8&255;d.push(String.fromCharCode(f))}return d.join("")},parse:function(a){for(var b=a.length,c=[],d=0;b>d;d++)c[d>>>2]|=(255&a.charCodeAt(d))<<24-d%4*8;return new f.init(c,b)}},j=g.Utf8={stringify:function(a){try{return decodeURIComponent(escape(i.stringify(a)))}catch(b){throw new Error("Malformed UTF-8 data")}},parse:function(a){return i.parse(unescape(encodeURIComponent(a)))}},k=(g.Base64={stringify:function(a){var b=a.words,c=a.sigBytes,d=this._map;a.clamp();for(var e=[],f=0;c>f;f+=3)for(var g=b[f>>>2]>>>24-f%4*8&255,h=b[f+1>>>2]>>>24-(f+1)%4*8&255,i=b[f+2>>>2]>>>24-(f+2)%4*8&255,j=g<<16|h<<8|i,k=0;4>k&&c>f+.75*k;k++)e.push(d.charAt(j>>>6*(3-k)&63));var l=d.charAt(64);if(l)for(;e.length%4;)e.push(l);return e.join("")},parse:function(a){var b=a.length,c=this._map,d=c.charAt(64);if(d){var e=a.indexOf(d);-1!=e&&(b=e)}for(var g=[],h=0,i=0;b>i;i++)if(i%4){var j=c.indexOf(a.charAt(i-1))<<i%4*2,k=c.indexOf(a.charAt(i))>>>6-i%4*2;g[h>>>2]|=(j|k)<<24-h%4*8,h++}return f.create(g,h)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="},d.BufferedBlockAlgorithm=e.extend({reset:function(){this._data=new f.init,this._nDataBytes=0},_append:function(a){"string"==typeof a&&(a=j.parse(a)),this._data.concat(a),this._nDataBytes+=a.sigBytes},_process:function(b){var c=this._data,d=c.words,e=c.sigBytes,g=this.blockSize,h=4*g,i=e/h;i=b?a.ceil(i):a.max((0|i)-this._minBufferSize,0);var j=i*g,k=a.min(4*j,e);if(j){for(var l=0;j>l;l+=g)this._doProcessBlock(d,l);var m=d.splice(0,j);c.sigBytes-=k}return new f.init(m,k)},clone:function(){var a=e.clone.call(this);return a._data=this._data.clone(),a},_minBufferSize:0})),l=d.Hasher=k.extend({cfg:e.extend(),init:function(a){this.cfg=this.cfg.extend(a),this.reset()},reset:function(){k.reset.call(this),this._doReset()},update:function(a){return this._append(a),this._process(),this},finalize:function(a){a&&this._append(a);var b=this._doFinalize();return b},blockSize:16,_createHelper:function(a){return function(b,c){return new a.init(c).finalize(b)}},_createHmacHelper:function(a){return function(b,c){return new m.HMAC.init(a,c).finalize(b)}}}),m=c.algo={},n=[],o=m.SHA1=l.extend({_doReset:function(){this._hash=new f.init([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(a,b){for(var c=this._hash.words,d=c[0],e=c[1],f=c[2],g=c[3],h=c[4],i=0;80>i;i++){if(16>i)n[i]=0|a[b+i];else{var j=n[i-3]^n[i-8]^n[i-14]^n[i-16];n[i]=j<<1|j>>>31}var k=(d<<5|d>>>27)+h+n[i];k+=20>i?(e&f|~e&g)+1518500249:40>i?(e^f^g)+1859775393:60>i?(e&f|e&g|f&g)-1894007588:(e^f^g)-899497514,h=g,g=f,f=e<<30|e>>>2,e=d,d=k}c[0]=c[0]+d|0,c[1]=c[1]+e|0,c[2]=c[2]+f|0,c[3]=c[3]+g|0,c[4]=c[4]+h|0},_doFinalize:function(){var b=this._data,c=b.words,d=8*this._nDataBytes,e=8*b.sigBytes;return c[e>>>5]|=128<<24-e%32,c[(e+64>>>9<<4)+14]=a.floor(d/4294967296),c[(e+64>>>9<<4)+15]=d,b.sigBytes=4*c.length,this._process(),this._hash},clone:function(){var a=l.clone.call(this);return a._hash=this._hash.clone(),a}});return c.SHA1=l._createHelper(o),c.HmacSHA1=l._createHmacHelper(o),c}(Math),CryptoJS=CryptoJS||function(a,b){var c={},d=c.lib={},e=function(){},f=d.Base={extend:function(a){e.prototype=this;var b=new e;return a&&b.mixIn(a),b.hasOwnProperty("init")||(b.init=function(){b.$super.init.apply(this,arguments)}),b.init.prototype=b,b.$super=this,b},create:function(){var a=this.extend();return a.init.apply(a,arguments),a},init:function(){},mixIn:function(a){for(var b in a)a.hasOwnProperty(b)&&(this[b]=a[b]);a.hasOwnProperty("toString")&&(this.toString=a.toString)},clone:function(){return this.init.prototype.extend(this)}},g=d.WordArray=f.extend({init:function(a,c){a=this.words=a||[],this.sigBytes=c!=b?c:4*a.length},toString:function(a){return(a||i).stringify(this)},concat:function(a){var b=this.words,c=a.words,d=this.sigBytes;if(a=a.sigBytes,this.clamp(),d%4)for(var e=0;a>e;e++)b[d+e>>>2]|=(c[e>>>2]>>>24-8*(e%4)&255)<<24-8*((d+e)%4);else if(65535<c.length)for(e=0;a>e;e+=4)b[d+e>>>2]=c[e>>>2];else b.push.apply(b,c);return this.sigBytes+=a,this},clamp:function(){var b=this.words,c=this.sigBytes;b[c>>>2]&=4294967295<<32-8*(c%4),b.length=a.ceil(c/4)},clone:function(){var a=f.clone.call(this);return a.words=this.words.slice(0),a},random:function(b){for(var c=[],d=0;b>d;d+=4)c.push(4294967296*a.random()|0);return new g.init(c,b)}}),h=c.enc={},i=h.Hex={stringify:function(a){var b=a.words;a=a.sigBytes;for(var c=[],d=0;a>d;d++){var e=b[d>>>2]>>>24-8*(d%4)&255;c.push((e>>>4).toString(16)),c.push((15&e).toString(16))}return c.join("")},parse:function(a){for(var b=a.length,c=[],d=0;b>d;d+=2)c[d>>>3]|=parseInt(a.substr(d,2),16)<<24-4*(d%8);return new g.init(c,b/2)}},j=h.Latin1={stringify:function(a){var b=a.words;a=a.sigBytes;for(var c=[],d=0;a>d;d++)c.push(String.fromCharCode(b[d>>>2]>>>24-8*(d%4)&255));return c.join("")},parse:function(a){for(var b=a.length,c=[],d=0;b>d;d++)c[d>>>2]|=(255&a.charCodeAt(d))<<24-8*(d%4);return new g.init(c,b)}},k=h.Utf8={stringify:function(a){try{return decodeURIComponent(escape(j.stringify(a)))}catch(b){throw Error("Malformed UTF-8 data")}},parse:function(a){return j.parse(unescape(encodeURIComponent(a)))}},l=d.BufferedBlockAlgorithm=f.extend({reset:function(){this._data=new g.init,this._nDataBytes=0},_append:function(a){"string"==typeof a&&(a=k.parse(a)),this._data.concat(a),this._nDataBytes+=a.sigBytes},_process:function(b){var c=this._data,d=c.words,e=c.sigBytes,f=this.blockSize,h=e/(4*f),h=b?a.ceil(h):a.max((0|h)-this._minBufferSize,0);if(b=h*f,e=a.min(4*b,e),b){for(var i=0;b>i;i+=f)this._doProcessBlock(d,i);i=d.splice(0,b),c.sigBytes-=e}return new g.init(i,e)},clone:function(){var a=f.clone.call(this);return a._data=this._data.clone(),a},_minBufferSize:0});d.Hasher=l.extend({cfg:f.extend(),init:function(a){this.cfg=this.cfg.extend(a),this.reset()},reset:function(){l.reset.call(this),this._doReset()},update:function(a){return this._append(a),this._process(),this},finalize:function(a){return a&&this._append(a),this._doFinalize()},blockSize:16,_createHelper:function(a){return function(b,c){return new a.init(c).finalize(b)}},_createHmacHelper:function(a){return function(b,c){return new m.HMAC.init(a,c).finalize(b)}}});var m=c.algo={};return c}(Math);!function(a){for(var b=CryptoJS,c=b.lib,d=c.WordArray,e=c.Hasher,c=b.algo,f=[],g=[],h=function(a){return 4294967296*(a-(0|a))|0},i=2,j=0;64>j;){var k;a:{k=i;for(var l=a.sqrt(k),m=2;l>=m;m++)if(!(k%m)){k=!1;break a}k=!0}k&&(8>j&&(f[j]=h(a.pow(i,.5))),g[j]=h(a.pow(i,1/3)),j++),i++}var n=[],c=c.SHA256=e.extend({_doReset:function(){this._hash=new d.init(f.slice(0))},_doProcessBlock:function(a,b){for(var c=this._hash.words,d=c[0],e=c[1],f=c[2],h=c[3],i=c[4],j=c[5],k=c[6],l=c[7],m=0;64>m;m++){if(16>m)n[m]=0|a[b+m];else{var o=n[m-15],p=n[m-2];n[m]=((o<<25|o>>>7)^(o<<14|o>>>18)^o>>>3)+n[m-7]+((p<<15|p>>>17)^(p<<13|p>>>19)^p>>>10)+n[m-16]}o=l+((i<<26|i>>>6)^(i<<21|i>>>11)^(i<<7|i>>>25))+(i&j^~i&k)+g[m]+n[m],p=((d<<30|d>>>2)^(d<<19|d>>>13)^(d<<10|d>>>22))+(d&e^d&f^e&f),l=k,k=j,j=i,i=h+o|0,h=f,f=e,e=d,d=o+p|0}c[0]=c[0]+d|0,c[1]=c[1]+e|0,c[2]=c[2]+f|0,c[3]=c[3]+h|0,c[4]=c[4]+i|0,c[5]=c[5]+j|0,c[6]=c[6]+k|0,c[7]=c[7]+l|0},_doFinalize:function(){var b=this._data,c=b.words,d=8*this._nDataBytes,e=8*b.sigBytes;return c[e>>>5]|=128<<24-e%32,c[(e+64>>>9<<4)+14]=a.floor(d/4294967296),c[(e+64>>>9<<4)+15]=d,b.sigBytes=4*c.length,this._process(),this._hash},clone:function(){var a=e.clone.call(this);return a._hash=this._hash.clone(),a}});b.SHA256=e._createHelper(c),b.HmacSHA256=e._createHmacHelper(c)}(Math),function(){var a=CryptoJS,b=a.enc.Utf8;a.algo.HMAC=a.lib.Base.extend({init:function(a,c){a=this._hasher=new a.init,"string"==typeof c&&(c=b.parse(c));var d=a.blockSize,e=4*d;c.sigBytes>e&&(c=a.finalize(c)),c.clamp();for(var f=this._oKey=c.clone(),g=this._iKey=c.clone(),h=f.words,i=g.words,j=0;d>j;j++)h[j]^=1549556828,i[j]^=909522486;f.sigBytes=g.sigBytes=e,this.reset()},reset:function(){var a=this._hasher;a.reset(),a.update(this._iKey)},update:function(a){return this._hasher.update(a),this},finalize:function(a){var b=this._hasher;return a=b.finalize(a),b.reset(),b.finalize(this._oKey.clone().concat(a))}})}();var ADL,onBrowser=!1;if("undefined"!=typeof module){ADL=require("./index.js"),module.exports=ADL;var CryptoJS=require("crypto-js")}else ADL=window.ADL=window.ADL||{},onBrowser=!0;!function(a){function b(){try{return void 0!=this.lrs.endpoint&&""!=this.lrs.endpoint}catch(a){return!1}}function c(a){if(!c.debug)return!1;try{return console.log(a),!0}catch(b){return!1}}function d(a,b){for(var e in b){prop=b[e],c(e+" : "+prop);try{b[e].constructor==Object?a[e]=d(a[e],b[e]):(void 0==a&&(a=new Object),a[e]=b[e])}catch(f){void 0==a&&(a=new Object),a[e]=b[e]}}return a}function e(a){var b,c,e=["endpoint","auth","actor","registration","activity_id","grouping","activity_platform"],g=new Object;if(b=f(),void 0!==b&&0!==Object.keys(b).length){for(var h=0;h<e.length;h++)c=e[h],b[c]&&(g[c]=b[c],delete b[c]);0!==Object.keys(b).length&&(g.extended=b),g=d(a,g)}else g=a;return g}function f(){var a,b,c,d,e,f=onBrowser?window.location.search:h.search;for(a=f?f.substr(1):"",b=a.split("&"),e={},d=0;d<b.length;d++)c=b[d].split("="),2===c.length&&c[0]&&(e[c[0]]=decodeURIComponent(c[1]));return e}function g(){var b,c;onBrowser?(b=new XMLHttpRequest,c=window.location):(b=new i,c=h),c+="?forcenocache="+a.Util.ruuid(),b.open("GET",c,!1),b.send(null)}if(!onBrowser)var h=require("url"),i=require("xhr2");var j=function(){var b={};b.endpoint="https://lrs.adlnet.gov/xapi/";try{b.auth="Basic "+a.Util.toBase64("tom:1234")}catch(d){c("Exception in Config trying to encode auth: "+d)}return b}();XAPIWrapper=function(f,g){function i(a){var b;return onBrowser?(b=document.createElement("a"),b.href=a):b=h.parse(a),b.protocol&&b.host?b.protocol+"//"+b.host:void c("Couldn't create base url from endpoint: "+a)}function j(b,c,d){b.auth="Basic "+a.Util.toBase64(c+":"+d)}this.lrs=e(f||{}),this.lrs.user&&this.lrs.password&&j(this.lrs,this.lrs.user,this.lrs.password),this.base=i(this.lrs.endpoint),this.withCredentials=!1,this.withCredentials=f&&f.withCredentials,g&&b.call(this)&&a.XHR_request(this.lrs,this.lrs.endpoint+"about","GET",null,null,function(a){if(200==a.status)try{var b=JSON.parse(a.response),c=!1;for(var d in b.version)if(b.version[d]==this.xapiVersion){c=!0;break}c||this.log("The lrs version ["+b.version+"] does not match this wrapper's XAPI version ["+this.xapiVersion+"]")}catch(e){this.log("The response was not an about object")}else this.log("The request to get information about the LRS failed: "+a)},null,!1,null,this.withCredentials),this.searchParams=function(){var a={format:"exact"};return a},this.hash=function(b){if(!b)return null;try{return a.Util.toSHA1(b)}catch(c){return a.XAPIWrapper.log("Error trying to hash -- "+c),null}},this.changeConfig=function(a){try{c("updating lrs object with new configuration"),this.lrs=d(this.lrs,a),a.user&&a.password&&j(this.lrs,a.user,a.password),this.base=i(this.lrs.endpoint),this.withCredentials=a.withCredentials}catch(b){c("error while changing configuration -- "+b)}},this.updateAuth=j},XAPIWrapper.prototype.xapiVersion="1.0.3",XAPIWrapper.prototype.prepareStatement=function(a){void 0===a.actor?a.actor=JSON.parse(this.lrs.actor):"string"==typeof a.actor&&(a.actor=JSON.parse(a.actor)),(this.lrs.grouping||this.lrs.registration||this.lrs.activity_platform)&&(a.context||(a.context={})),this.lrs.grouping&&(a.context.contextActivities||(a.context.contextActivities={}),a.context.contextActivities.grouping=[{id:this.lrs.grouping}]),this.lrs.registration&&(a.context.registration=this.lrs.registration),this.lrs.activity_platform&&(a.context.platform=this.lrs.activity_platform)},XAPIWrapper.prototype.testConfig=b,XAPIWrapper.prototype.log=c,XAPIWrapper.prototype.putStatement=function(b,c,d,e){if(this.testConfig()){this.prepareStatement(b),b.id=null==c||""==c?a.Util.ruuid():c;var f=JSON.stringify(b),g=null;e&&e.length>0&&(g={},f=this.buildMultipart(b,e,g));var h=a.XHR_request(this.lrs,this.lrs.endpoint+"statements","PUT",f,this.lrs.auth,d,b.id,null,g,this.withCredentials);if(!d)return{xhr:h,id:b.id}}},XAPIWrapper.prototype.postStatement=function(b,c,d){if(this.testConfig()){this.prepareStatement(b);var e;b.id?e=b.id:(e=a.Util.ruuid(),b.id=e);var f=JSON.stringify(b),g=null;d&&d.length>0&&(g={},f=this.buildMultipart(b,d,g));var h=a.XHR_request(this.lrs,this.lrs.endpoint+"statements","POST",f,this.lrs.auth,c,null,null,g,this.withCredentials);if(!c)return{xhr:h,id:e}}},XAPIWrapper.prototype.buildMultipart=function(b,c,d){b.attachments=[];for(var e=0;e<c.length;e++)"signature"==c[e].type&&(c[e].type={usageType:"http://adlnet.gov/expapi/attachments/signature",display:{"en-US":"A JWT signature"},description:{"en-US":"A signature proving the statement was not modified"},contentType:"application/octet-stream"}),c[e].type.length=c[e].value.length,c[e].type.sha2=a.Util.toSHA256(c[e].value),b.attachments.push(c[e].type);var f="",g="\r\n",h=(Math.random()+" ").substring(2,10)+(Math.random()+" ").substring(2,10);d["Content-Type"]="multipart/mixed; boundary="+h,f+=g+"--"+h+g+"Content-Type:application/json"+g+'Content-Disposition: form-data; name="statement"'+g+g,f+=JSON.stringify(b);for(var e in c)f+=g+"--"+h+g+"X-Experience-API-Hash:"+c[e].type.sha2+g+"Content-Type:application/octet-stream"+g+"Content-Transfer-Encoding: binary"+g+g,f+=c[e].value;return f+=g+"--"+h+"--"+g},XAPIWrapper.prototype.postStatements=function(b,c){if(this.testConfig()){for(var d in b)this.prepareStatement(b[d]);var e=a.XHR_request(this.lrs,this.lrs.endpoint+"statements","POST",JSON.stringify(b),this.lrs.auth,c,null,!1,null,this.withCredentials);if(!c)return e}},XAPIWrapper.prototype.getStatements=function(b,c,d){if(this.testConfig()){var e=this.lrs.endpoint+"statements";if(c)e=this.base+c;else{var f=new Array;for(s in b)if("until"==s||"since"==s){var g=new Date(b[s]);f.push(s+"="+encodeURIComponent(g.toISOString()))}else f.push(s+"="+encodeURIComponent(b[s]));f.length>0&&(e=e+"?"+f.join("&"))}var h=a.XHR_request(this.lrs,e,"GET",null,this.lrs.auth,d,null,!1,null,this.withCredentials);if(void 0===h||404==h.status)return null;try{return JSON.parse(h.response)}catch(i){return h.response}}},XAPIWrapper.prototype.getMoreStatements=function(b,c,d){if(!onBrowser)throw new Error("Node not supported.");var e=[];a.XAPIWrapper.getStatements(d,null,function f(g){if(g&&g.response){var h=JSON.parse(g.response);h.statements&&(e=e.concat(h.statements),b--<=0?c(e):h.more&&""!==h.more?a.XAPIWrapper.getStatements(d,h.more,f):""===h.more&&c(e))}})},XAPIWrapper.prototype.getActivities=function(b,c){if(this.testConfig()){var d=this.lrs.endpoint+"activities?activityId=<activityid>";d=d.replace("<activityid>",encodeURIComponent(b));var e=a.XHR_request(this.lrs,d,"GET",null,this.lrs.auth,c,null,!0,null,this.withCredentials);if(void 0===e||404==e.status)return null;try{return JSON.parse(e.response)}catch(f){return e.response}}},XAPIWrapper.prototype.putState=function(b,c,d,e,f,g,h){if(this.testConfig()){if(!f)return!1;g&&""!=g||(g="*");var i=this.lrs.endpoint+"activities/state?activityId=<activity ID>&agent=<agent>&stateId=<stateid>";i=i.replace("<activity ID>",encodeURIComponent(b)),i=i.replace("<agent>",encodeURIComponent(JSON.stringify(c))),i=i.replace("<stateid>",encodeURIComponent(d)),e&&(i+="&registration="+encodeURIComponent(e));var j={"If-Match":'"'+g+'"'};f instanceof Array||f instanceof Object?(f=JSON.stringify(f),j["Content-Type"]="application/json"):j["Content-Type"]="application/octet-stream",a.XHR_request(this.lrs,i,"PUT",f,this.lrs.auth,h,null,null,j,this.withCredentials)}},XAPIWrapper.prototype.postState=function(b,c,d,e,f,g){if(this.testConfig()){if(!f)return!1;var h=this.lrs.endpoint+"activities/state?activityId=<activity ID>&agent=<agent>&stateId=<stateid>";h=h.replace("<activity ID>",encodeURIComponent(b)),h=h.replace("<agent>",encodeURIComponent(JSON.stringify(c))),h=h.replace("<stateid>",encodeURIComponent(d)),e&&(h+="&registration="+encodeURIComponent(e));var i={};f instanceof Array||f instanceof Object?(f=JSON.stringify(f),i["Content-Type"]="application/json"):i["Content-Type"]="application/octet-stream",a.XHR_request(this.lrs,h,"POST",f,this.lrs.auth,g,null,null,i,this.withCredentials)}},XAPIWrapper.prototype.getState=function(b,c,d,e,f,g){if(this.testConfig()){var h=this.lrs.endpoint+"activities/state?activityId=<activity ID>&agent=<agent>";h=h.replace("<activity ID>",encodeURIComponent(b)),h=h.replace("<agent>",encodeURIComponent(JSON.stringify(c))),d&&(h+="&stateId="+encodeURIComponent(d)),e&&(h+="&registration="+encodeURIComponent(e)),f&&(f=a.Util.isDate(f),null!=f&&(h+="&since="+encodeURIComponent(f.toISOString())));var i=a.XHR_request(this.lrs,h,"GET",null,this.lrs.auth,g,null,!0,null,this.withCredentials);if(void 0===i||404==i.status)return null;try{return JSON.parse(i.response)}catch(j){return i.response}}},XAPIWrapper.prototype.deleteState=function(b,c,d,e,f){if(this.testConfig()){var g=this.lrs.endpoint+"activities/state?activityId=<activity ID>&agent=<agent>";g=g.replace("<activity ID>",encodeURIComponent(b)),g=g.replace("<agent>",encodeURIComponent(JSON.stringify(c))),d&&(g+="&stateId="+encodeURIComponent(d)),e&&(g+="&registration="+encodeURIComponent(e));var h=null,i=a.XHR_request(this.lrs,g,"DELETE",null,this.lrs.auth,f,null,!1,h,this.withCredentials);if(void 0===i||404==i.status)return null;try{return JSON.parse(i.response)}catch(j){return i}}},XAPIWrapper.prototype.putActivityProfile=function(b,c,d,e,f){if(this.testConfig()){if(!d)return!1;e&&""!=e||(e="*");var g=this.lrs.endpoint+"activities/profile?activityId=<activity ID>&profileId=<profileid>";g=g.replace("<activity ID>",encodeURIComponent(b)),g=g.replace("<profileid>",encodeURIComponent(c));var h={"If-Match":'"'+e+'"'};d instanceof Array||d instanceof Object?(d=JSON.stringify(d),h["Content-Type"]="application/json"):h["Content-Type"]="application/octet-stream",a.XHR_request(this.lrs,g,"PUT",d,this.lrs.auth,f,null,!1,h,this.withCredentials)}},XAPIWrapper.prototype.postActivityProfile=function(b,c,d,e){if(this.testConfig()){if(!d)return!1;var f=this.lrs.endpoint+"activities/profile?activityId=<activity ID>&profileId=<profileid>";f=f.replace("<activity ID>",encodeURIComponent(b)),f=f.replace("<profileid>",encodeURIComponent(c));var g={};d instanceof Array||d instanceof Object?(d=JSON.stringify(d),g["Content-Type"]="application/json"):g["Content-Type"]="application/octet-stream",a.XHR_request(this.lrs,f,"POST",d,this.lrs.auth,e,null,!1,g,this.withCredentials)}},XAPIWrapper.prototype.getActivityProfile=function(b,c,d,e){if(this.testConfig()){var f=this.lrs.endpoint+"activities/profile?activityId=<activity ID>";f=f.replace("<activity ID>",encodeURIComponent(b)),c&&(f+="&profileId="+encodeURIComponent(c)),d&&(d=a.Util.isDate(d),null!=d&&(f+="&since="+encodeURIComponent(d.toISOString())));var g=a.XHR_request(this.lrs,f,"GET",null,this.lrs.auth,e,null,!0,null,this.withCredentials);if(void 0===g||404==g.status)return null;try{return JSON.parse(g.response)}catch(h){return g.response}}},XAPIWrapper.prototype.deleteActivityProfile=function(b,c,d){if(this.testConfig()){var e=this.lrs.endpoint+"activities/profile?activityId=<activity ID>&profileId=<profileid>";e=e.replace("<activity ID>",encodeURIComponent(b)),e=e.replace("<profileid>",encodeURIComponent(c));var f=null,g=a.XHR_request(this.lrs,e,"DELETE",null,this.lrs.auth,d,null,!1,f,this.withCredentials);if(void 0===g||404==g.status)return null;try{return JSON.parse(g.response)}catch(h){return g}}},XAPIWrapper.prototype.getAgents=function(b,c){if(this.testConfig()){var d=this.lrs.endpoint+"agents?agent=<agent>";d=d.replace("<agent>",encodeURIComponent(JSON.stringify(b)));var e=a.XHR_request(this.lrs,d,"GET",null,this.lrs.auth,c,null,!0,null,this.withCredentials);if(void 0===e||404==e.status)return null;try{return JSON.parse(e.response)}catch(f){return e.response}}},XAPIWrapper.prototype.putAgentProfile=function(b,c,d,e,f){if(this.testConfig()){if(!d)return!1;e&&""!=e||(e="*");var g=this.lrs.endpoint+"agents/profile?agent=<agent>&profileId=<profileid>";g=g.replace("<agent>",encodeURIComponent(JSON.stringify(b))),g=g.replace("<profileid>",encodeURIComponent(c));var h={"If-Match":'"'+e+'"'};d instanceof Array||d instanceof Object?(d=JSON.stringify(d),h["Content-Type"]="application/json"):h["Content-Type"]="application/octet-stream",a.XHR_request(this.lrs,g,"PUT",d,this.lrs.auth,f,null,!1,h,this.withCredentials)}},XAPIWrapper.prototype.postAgentProfile=function(b,c,d,e){if(this.testConfig()){if(!d)return!1;var f=this.lrs.endpoint+"agents/profile?agent=<agent>&profileId=<profileid>";f=f.replace("<agent>",encodeURIComponent(JSON.stringify(b))),f=f.replace("<profileid>",encodeURIComponent(c));var g={};d instanceof Array||d instanceof Object?(d=JSON.stringify(d),g["Content-Type"]="application/json"):g["Content-Type"]="application/octet-stream",a.XHR_request(this.lrs,f,"POST",d,this.lrs.auth,e,null,!1,g,this.withCredentials)}},XAPIWrapper.prototype.getAgentProfile=function(b,c,d,e){if(this.testConfig()){var f=this.lrs.endpoint+"agents/profile?agent=<agent>";f=f.replace("<agent>",encodeURIComponent(JSON.stringify(b))),f=f.replace("<profileid>",encodeURIComponent(c)),c&&(f+="&profileId="+encodeURIComponent(c)),d&&(d=a.Util.isDate(d),null!=d&&(f+="&since="+encodeURIComponent(d.toISOString())));var g=a.XHR_request(this.lrs,f,"GET",null,this.lrs.auth,e,null,!0,null,this.withCredentials);if(void 0===g||404==g.status)return null;try{return JSON.parse(g.response)}catch(h){return g.response}}},XAPIWrapper.prototype.deleteAgentProfile=function(b,c,d){if(this.testConfig()){var e=this.lrs.endpoint+"agents/profile?agent=<agent>&profileId=<profileid>";e=e.replace("<agent>",encodeURIComponent(JSON.stringify(b))),e=e.replace("<profileid>",encodeURIComponent(c));var f=null,g=a.XHR_request(this.lrs,e,"DELETE",null,this.lrs.auth,d,null,!1,f,this.withCredentials);if(void 0===g||404==g.status)return null;try{return JSON.parse(g.response)}catch(h){return g}}},a.XHR_request=function(b,c,d,e,f,h,j,k,l,m){"use strict";function n(){if(t)return r;t=!0;var b=k&&404===o.status;if(!(void 0===o.status||o.status>=200&&o.status<400||b)){var e;try{e="There was a problem communicating with the Learning Record Store. ( "+o.status+" | "+o.response+" )"+c}catch(f){e=f.toString()}return a.XAPIWrapper.log(e),a.xhrRequestOnError(o,d,c,h,j),r=o,o}if(!h)return r=o,o;if(j)h(o,j);else try{var g=JSON.parse(o.responseText);h(o,g)}catch(i){h(o,o.responseText)}}var o,p,q,r,s,t=!1,u=!1,v=!1,w=c.toLowerCase().match(/^(.+):\/\/([^:\/]*):?(\d+)?(\/.*)?$/),x=onBrowser?window.location:c,y={};if(y["Content-Type"]="application/json",y.Authorization=f,y["X-Experience-API-Version"]=a.XAPIWrapper.xapiVersion,null!==l)for(var z in l)y[z]=l[z];u=x.protocol!==w[1]||x.hostname!==w[2],u||(q=null===w[3]?"http"===w[1]?"80":"443":w[3],u=q===x.port);var A=!1;if(onBrowser&&(A=window.XDomainRequest&&window.XMLHttpRequest&&void 0===(new XMLHttpRequest).responseType),u&&void 0!==A&&A!==!1)v=!0,p=a.XAPIWrapper.ie_request(d,c,y,e),o=new XDomainRequest,o.open(p.method,p.url);else{o=onBrowser?new XMLHttpRequest:new i,o.withCredentials=m,o.open(d,c,null!=h);for(var z in y)o.setRequestHeader(z,y[z])}if(o.onreadystatechange=function(){return 4===o.readyState?n():void 0},o.onload=n,o.onerror=n,o.send(v?p.data:e),!h){if(v)for(s=1e3+new Date;new Date<s&&4!==o.readyState&&!t;)g();return n()}},a.xhrRequestOnError=function(a,b,c,d,e){},a.XAPIWrapper=new XAPIWrapper(j,!1)}(ADL),function(a){var b=a.Agent=function(a,b){if(this.objectType="Agent",this.name=b,a&&(a.mbox||a.mbox_sha1sum||a.openid||a.account))for(var c in a)this[c]=a[c];else/^mailto:/.test(a)?this.mbox=a:/^[0-9a-f]{40}$/i.test(a)?this.mbox_sha1sum=a:/^http[s]?:/.test(a)?this.openid=a:a&&a.homePage&&a.name&&(this.account=a)};b.prototype.toString=function(){return this.name||this.mbox||this.openid||this.mbox_sha1sum||this.account.name},b.prototype.isValid=function(){return this.mbox||this.mbox_sha1sum||this.openid||this.account.homePage&&this.account.name||"Group"===this.objectType&&this.member};var c=a.Group=function(a,c,d){b.call(this,a,d),this.member=c,this.objectType="Group"};c.prototype=new b,"undefined"!=typeof module&&"undefined"!=typeof module.exports&&(module.exports={Agent:b,Group:c})}("undefined"==typeof module?window.ADL=window.ADL||{}:this),function(a){var b=a.Verb=function(a,b){if(a&&a.id)for(var c in a)this[c]=a[c];else this.id=a,b&&("string"==typeof b||b instanceof String?this.display={"en-US":b}:this.display=b)};b.prototype.toString=function(){return this.display&&(this.display["en-US"]||this.display.en)?this.display["en-US"]||this.display.en:this.id},b.prototype.isValid=function(){return this.id},"undefined"!=typeof module&&"undefined"!=typeof module.exports&&(module.exports=b)}("undefined"==typeof module?window.ADL=window.ADL||{}:this),function(a){a.verbs={abandoned:{id:"https://w3id.org/xapi/adl/verbs/abandoned",display:{"en-US":"abandoned"}},answered:{id:"http://adlnet.gov/expapi/verbs/answered",display:{"de-DE":"beantwortete","en-US":"answered","fr-FR":"a répondu","es-ES":"contestó"}},asked:{id:"http://adlnet.gov/expapi/verbs/asked",display:{"de-DE":"fragte","en-US":"asked","fr-FR":"a demandé","es-ES":"preguntó"}},attempted:{id:"http://adlnet.gov/expapi/verbs/attempted",display:{"de-DE":"versuchte","en-US":"attempted","fr-FR":"a essayé","es-ES":"intentó"}},attended:{id:"http://adlnet.gov/expapi/verbs/attended",display:{"de-DE":"nahm teil an","en-US":"attended","fr-FR":"a suivi","es-ES":"asistió"}},commented:{id:"http://adlnet.gov/expapi/verbs/commented",display:{"de-DE":"kommentierte","en-US":"commented","fr-FR":"a commenté","es-ES":"comentó"}},completed:{id:"http://adlnet.gov/expapi/verbs/completed",display:{"de-DE":"beendete","en-US":"completed","fr-FR":"a terminé","es-ES":"completó"}},exited:{id:"http://adlnet.gov/expapi/verbs/exited",display:{"de-DE":"verließ","en-US":"exited","fr-FR":"a quitté","es-ES":"salió"}},experienced:{id:"http://adlnet.gov/expapi/verbs/experienced",display:{"de-DE":"erlebte","en-US":"experienced","fr-FR":"a éprouvé","es-ES":"experimentó"}},failed:{id:"http://adlnet.gov/expapi/verbs/failed",display:{"de-DE":"verfehlte","en-US":"failed","fr-FR":"a échoué","es-ES":"fracasó"}},imported:{id:"http://adlnet.gov/expapi/verbs/imported",display:{"de-DE":"importierte","en-US":"imported","fr-FR":"a importé","es-ES":"importó"}},initialized:{id:"http://adlnet.gov/expapi/verbs/initialized",display:{"de-DE":"initialisierte","en-US":"initialized","fr-FR":"a initialisé","es-ES":"inicializó"}},interacted:{id:"http://adlnet.gov/expapi/verbs/interacted",display:{"de-DE":"interagierte","en-US":"interacted","fr-FR":"a interagi","es-ES":"interactuó"}},launched:{id:"http://adlnet.gov/expapi/verbs/launched",display:{"de-DE":"startete","en-US":"launched","fr-FR":"a lancé","es-ES":"lanzó"}},mastered:{id:"http://adlnet.gov/expapi/verbs/mastered",display:{"de-DE":"meisterte","en-US":"mastered","fr-FR":"a maîtrisé","es-ES":"dominó"}},passed:{id:"http://adlnet.gov/expapi/verbs/passed",display:{"de-DE":"bestand","en-US":"passed","fr-FR":"a réussi","es-ES":"aprobó"}},preferred:{id:"http://adlnet.gov/expapi/verbs/preferred",display:{"de-DE":"bevorzugte","en-US":"preferred","fr-FR":"a préféré","es-ES":"prefirió"}},progressed:{id:"http://adlnet.gov/expapi/verbs/progressed",display:{"de-DE":"machte Fortschritt mit","en-US":"progressed","fr-FR":"a progressé","es-ES":"progresó"}},registered:{id:"http://adlnet.gov/expapi/verbs/registered",display:{"de-DE":"registrierte","en-US":"registered","fr-FR":"a enregistré","es-ES":"registró"}},responded:{id:"http://adlnet.gov/expapi/verbs/responded",display:{"de-DE":"reagierte","en-US":"responded","fr-FR":"a répondu","es-ES":"respondió"}},resumed:{id:"http://adlnet.gov/expapi/verbs/resumed",display:{"de-DE":"setzte fort","en-US":"resumed","fr-FR":"a repris","es-ES":"continuó"}},satisfied:{id:"https://w3id.org/xapi/adl/verbs/satisfied",display:{"en-US":"satisfied"}},scored:{id:"http://adlnet.gov/expapi/verbs/scored",display:{"de-DE":"erreichte","en-US":"scored","fr-FR":"a marqué","es-ES":"anotó"}},shared:{id:"http://adlnet.gov/expapi/verbs/shared",display:{"de-DE":"teilte","en-US":"shared","fr-FR":"a partagé","es-ES":"compartió"}},suspended:{id:"http://adlnet.gov/expapi/verbs/suspended",display:{"de-DE":"pausierte","en-US":"suspended","fr-FR":"a suspendu","es-ES":"aplazó"}},terminated:{id:"http://adlnet.gov/expapi/verbs/terminated",display:{"de-DE":"beendete","en-US":"terminated","fr-FR":"a terminé","es-ES":"terminó"}},voided:{id:"http://adlnet.gov/expapi/verbs/voided",display:{"de-DE":"entwertete","en-US":"voided","fr-FR":"a annulé","es-ES":"anuló"}},waived:{id:"https://w3id.org/xapi/adl/verbs/waived",display:{"en-US":"waived"}}},"undefined"!=typeof module&&"undefined"!=typeof module.exports&&(module.exports=a.verbs)}("undefined"==typeof module?window.ADL=window.ADL||{}:this),function(a){function b(a,c){var d=c.split("."),e=d[0];return c=d.slice(1).join("."),a[e]||(/\[\]$/.test(e)?(e=e.slice(0,-2),a[e]=[]):a[e]={}),c?b(a[e],c):a[e]}var c=a.Statement=function(b,c,d){if(b&&b.actor&&b.verb&&b.object){var e=b;for(var f in e)"actor"!=f&&"verb"!=f&&"object"!=f&&(this[f]=e[f]);b=e.actor,c=e.verb,d=e.object}b?b instanceof a.Agent?this.actor=b:"Agent"!==b.objectType&&b.objectType?"Group"===b.objectType&&(this.actor=new a.Group(b)):this.actor=new a.Agent(b):this.actor=null,c?c instanceof a.Verb?this.verb=c:this.verb=new a.Verb(c):this.verb=null,d?"Activity"!==d.objectType&&d.objectType?"Agent"===d.objectType?d instanceof a.Agent?this.object=d:this.object=new a.Agent(d):"Group"===d.objectType?d instanceof a.Group?this.object=d:this.object=new a.Group(d):"StatementRef"===d.objectType?d instanceof a.StatementRef?this.object=d:this.object=new a.StatementRef(d):"SubStatement"===d.objectType?d instanceof a.SubStatement?this.object=d:this.object=new a.SubStatement(d):this.object=null:d instanceof a.Activity?this.object=d:this.object=new a.Activity(d):this.object=null,this.generateId=function(){this.id=a.Util.ruuid()}};c.prototype.toString=function(){return this.actor.toString()+" "+this.verb.toString()+" "+this.object.toString()},c.prototype.isValid=function(){return this.actor&&this.actor.isValid()&&this.verb&&this.verb.isValid()&&this.object&&this.object.isValid();
},c.prototype.generateRegistration=function(){b(this,"context").registration=a.Util.ruuid()},c.prototype.addParentActivity=function(c){b(this,"context.contextActivities.parent[]").push(new a.Activity(c))},c.prototype.addGroupingActivity=function(c){b(this,"context.contextActivities.grouping[]").push(new a.Activity(c))},c.prototype.addOtherContextActivity=function(c){b(this,"context.contextActivities.other[]").push(new a.Activity(c))},"undefined"!=typeof module&&"undefined"!=typeof module.exports&&(module.exports=c)}("undefined"!=typeof module?require("./index.js"):window.ADL=window.ADL||{}),function(a){var b=a.Activity=function(a,b,c){if(a&&a.id){var d=a;for(var e in d)this[e]=d[e]}else this.objectType="Activity",this.id=a,(b||c)&&(this.definition={},"string"==typeof b||b instanceof String?this.definition.name={"en-US":b}:b&&(this.definition.name=b),"string"==typeof c||c instanceof String?this.definition.description={"en-US":c}:c&&(this.definition.description=c))};b.prototype.toString=function(){return this.definition&&this.definition.name&&(this.definition.name["en-US"]||this.definition.name.en)?this.definition.name["en-US"]||this.definition.name.en:this.id},b.prototype.isValid=function(){return this.id&&(!this.objectType||"Activity"===this.objectType)};var c=a.StatementRef=function(a){if(a&&a.id)for(var b in a)this[b]=a[b];else this.objectType="StatementRef",this.id=a};c.prototype.toString=function(){return"statement("+this.id+")"},c.prototype.isValid=function(){return this.id&&this.objectType&&"StatementRef"===this.objectType};var d=a.SubStatement=function(b,c,d){a.Statement.call(this,b,c,d),this.objectType="SubStatement",delete this.id,delete this.stored,delete this.version,delete this.authority};d.prototype=new a.Statement,d.prototype.toString=function(){return'"'+d.prototype.prototype.toString.call(this)+'"'},"undefined"!=typeof module&&"undefined"!=typeof module.exports&&(module.exports={Activity:b,StatementRef:c,SubStatement:d})}("undefined"!=typeof module?require("./index.js"):window.ADL=window.ADL||{}),Date.prototype.toISOString||!function(){function a(a){var b=String(a);return 1===b.length&&(b="0"+b),b}Date.prototype.toISOString=function(){return this.getUTCFullYear()+"-"+a(this.getUTCMonth()+1)+"-"+a(this.getUTCDate())+"T"+a(this.getUTCHours())+":"+a(this.getUTCMinutes())+":"+a(this.getUTCSeconds())+"."+String((this.getUTCMilliseconds()/1e3).toFixed(3)).slice(2,5)+"Z"}}(),function(a){var b=a,c=!1;"undefined"!=typeof window?(b=window.ADL=a.ADL||{},c=!0):CryptoJS=require("crypto-js");var d=function(a){return a.definition&&a.definition.name?b.Util.getLangVal(a.definition.name):void 0},e=function(a){if("SubStatement"===a.objectType&&"SubStatement"!==a.object.objectType&&!(a.id||a.stored||a.version||a.authority)){var c=b.Util.getActorId(a.actor)+":"+b.Util.getVerbDisplay(a.verb)+":"+b.Util.getObjectId(a.object);return c}};b.Util={},b.Util.getLang=function(){var a;if("undefined"!=typeof navigator)a=navigator.language||navigator.browserLanguage||navigator.systemLanguage||navigator.userLanguage;else if(process&&process.env){var b=process.env.LANG;a=b.slice(0,b.indexOf(".")),a=a.replace(/_/,"-")}return a||"en-US"},b.Util.getLangVal=function(a){if(a){var c=Object.keys(a);if(0==c.length)return void 0;var d,e=b.Util.getLang(),f=!1;do a[e]?(d=a[e],f=!0):e.indexOf("-")&&(e=e.substring(0,e.lastIndexOf("-")));while(!f&&""!==e);return d}},b.Util.getActorId=function(a){return a.mbox||a.openid||a.mbox_sha1sum||a.account},b.Util.getActorIdString=function(a){var b=a.mbox||a.openid||a.mbox_sha1sum;return b||(b=a.account?a.account.homePage+":"+a.account.name:a.member?"Anon Group "+a.member:"unknown"),b},b.Util.getActorDisplay=function(a){return a.name||b.Util.getActorIdString(a)},b.Util.getVerbDisplay=function(a){return a?a.display?b.Util.getLangVal(a.display)||a.id:a.id:void 0},b.Util.getObjectType=function(a){return a.objectType||(a.id?"Activity":"Agent")},b.Util.getObjectId=function(a){if(a.id)return a.id;var c=b.Util.getObjectType(a);return"Agent"===c||"Group"===c?b.Util.getActorId(a):void 0},b.Util.getObjectIdString=function(a){if(!a)return"unknown";if(a.id)return a.id;var c=b.Util.getObjectType(a);return"Agent"===c||"Group"===c?b.Util.getActorIdString(a):"SubStatement"==c?e(a):"unknown"},b.Util.getObjectDisplay=function(a){if(!a)return"unknown";var c=d(a)||a.name||a.id;if(!c){var f=b.Util.getObjectType(a);"Agent"===f||"Group"==f?c=b.Util.getActorDisplay(a):"SubStatement"==f&&(c=e(a))}return c},b.Util.ruuid=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var b=16*Math.random()|0,c="x"==a?b:3&b|8;return c.toString(16)})},b.Util.dateFromISOString=function(a){var b="([0-9]{4})(-([0-9]{2})(-([0-9]{2})([T| ]([0-9]{2}):([0-9]{2})(:([0-9]{2})(.([0-9]+))?)?(Z|(([-+])([0-9]{2}):([0-9]{2})))?)?)?)?",c=a.match(new RegExp(b)),d=0,e=new Date(c[1],0,1);c[3]&&e.setMonth(c[3]-1),c[5]&&e.setDate(c[5]),c[7]&&e.setHours(c[7]),c[8]&&e.setMinutes(c[8]),c[10]&&e.setSeconds(c[10]),c[12]&&e.setMilliseconds(1e3*Number("0."+c[12])),c[14]&&(d=60*Number(c[16])+Number(c[17]),d*="-"==c[15]?1:-1),d-=e.getTimezoneOffset(),time=Number(e)+60*d*1e3;var f=new Date;return f.setTime(Number(time)),f},b.Util.getByteLen=function(a){a=String(a);for(var b=0,c=0;c<a.length;c++){var d=a.charCodeAt(c);b+=128>d?1:2048>d?2:65536>d?3:1<<21>d?4:1<<26>d?5:1<<31>d?6:Number.NaN}return b},b.Util.toBase64=function(a){return CryptoJS&&CryptoJS.enc.Base64?CryptoJS.enc.Base64.stringify(CryptoJS.enc.Latin1.parse(a)):Base64.encode(a)},b.Util.toSHA1=function(a){return CryptoJS&&CryptoJS.SHA1?CryptoJS.SHA1(a).toString():Crypto.util.bytesToHex(Crypto.SHA1(a,{asBytes:!0}))},b.Util.toSHA256=function(a){return CryptoJS&&CryptoJS.SHA256?CryptoJS.SHA256(a).toString():void 0},b.Util.isDate=function(a){if("[object Date]"===Object.prototype.toString.call(a))var c=a;else var c=new Date(a);return"[object Date]"===Object.prototype.toString.call(c)?isNaN(c.valueOf())?(b.XAPIWrapper.prototype.log("Invalid date String passed"),null):c:(b.XAPIWrapper.prototype.log("Invalid date object"),null)},"undefined"!=typeof module&&"undefined"!=typeof module.exports&&(module.exports=b.Util)}(this);var ADL=module.exports;(function(){this.Agent=require("./Agent.js").Agent,this.Group=require("./Agent.js").Group,this.Verb=require("./Verb.js"),this.verbs=require("./verbs.js"),this.Statement=require("./Statement.js"),this.Activity=require("./Object.js").Activity,this.StatementRef=require("./Object.js").StatementRef,this.SubStatement=require("./Object.js").SubStatement,this.Util=require("./Utils.js")}).apply(ADL),function(a){function b(a){for(var b=window.location.search.substring(1),c=b.split("&"),d=0;d<c.length;d++){var e=c[d].split("=");if(decodeURIComponent(e[0])==a)return decodeURIComponent(e[1])}}function c(a){return function(){var b=arguments;window.setTimeout(function(){for(var c=[],d=0;d<b.length;d++)c.push(b[d]);a.apply(window,c)},0)}}function d(){var a=document.body,b=new MutationObserver(function(a){a.forEach(function(a){for(var b in a.addedNodes)if(a.addedNodes[b].constructor==HTMLAnchorElement){var c=a.addedNodes[b];e([c])}})}),c={attributes:!0,childList:!0,subtree:!0};b.observe(a,c)}function e(a){var c=b("xAPILaunchKey"),d=b("xAPILaunchService"),e=b("encrypted"),f="xAPILaunchKey="+c+"&xAPILaunchService="+d;e&&(f+="&encrypted=true");for(var g=0;g<a.length;g++){var h=a[g],i=h.href,j=h.attributes.getNamedItem("courselink");j&&"true"==j.value&&(i=i.indexOf("?")>-1?i+"&"+f:i+"?"+f,h.href=i)}}function f(a,h){a=c(a);try{var i=b("xAPILaunchKey"),j=b("xAPILaunchService");b("encrypted");if(f.terminate=function(a){var b=new URL(j);b.pathname+="launch/"+i+"/terminate";var c=new XMLHttpRequest;c.withCredentials=!0,c.crossDomain=!0,c.open("POST",b.toString(),!1),c.setRequestHeader("Content-type","application/json"),c.send(JSON.stringify({code:0,description:a||"User closed content"}))},!i||!j)return a("invalid launch parameters");var k=new URL(j);k.pathname+="launch/"+i;var l=new XMLHttpRequest;l.withCredentials=!0,l.crossDomain=!0,l.onerror=function(b){window.setTimeout(function(){return a(b)})},l.onload=function(b){if(200!==l.status)return l.onerror(l.responseText);var c=JSON.parse(l.responseText),i=c,j={};j.endpoint=i.endpoint,j.actor=i.actor,j.withCredentials=!0,window.onunload=function(){h&&f.terminate("User closed content")};var k=new g.XAPIWrapper.constructor;return k.changeConfig(j),e(document.body.querySelectorAll("a")),d(),a(null,c,k)},l.open("POST",k.toString(),!0),l.send()}catch(m){a(m)}}var g=a;g.launch=f}(window.ADL=window.ADL||{});